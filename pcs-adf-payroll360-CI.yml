trigger:
  branches:
    include:
    - refs/heads/adf_publish
resources:
  repositories:
  - repository: self
    type: git
    ref: refs/heads/adf_publish
jobs:
- job: Job_1
  displayName: Agent job 1
  pool:
    vmImage: vs2017-win2016
  steps:
  - checkout: self
  - task: AzureResourceManagerTemplateDeployment@3
    displayName: 'ARM Template deployment: Resource Group scope'
    enabled: False
    inputs:
      ConnectedServiceName: 5b7a5194-25d1-4b3f-8ad3-c3073ab9a0eb
      subscriptionName: 8aa224f7-539d-46b5-a81f-385ad15a78ab
      resourceGroupName: pcs-rg-payroll360-project
      location: East US
      csmFile: pcs-adf-payroll360-dev/ARMTemplateForFactory.json
      overrideParameters: -factoryName "$(factoryName)" -AzureBlobStorage1_connectionString "DefaultEndpointsProtocol=https;AccountName=stpayroll360qa001;AccountKey=9WLBIUk6ndW+WmyvqP7fy4FYMZDgy0z0dIjvGRP+sdzb4YifR42qwV5Erh0VoxNLfgD+s6Qa/Bt7Fz6LeMAgtQ==;EndpointSuffix=core.windows.net" -AzureBlobStorage2_connectionString "DefaultEndpointsProtocol=https;AccountName=stpayroll360qa001;AccountKey=9WLBIUk6ndW+WmyvqP7fy4FYMZDgy0z0dIjvGRP+sdzb4YifR42qwV5Erh0VoxNLfgD+s6Qa/Bt7Fz6LeMAgtQ==;EndpointSuffix=core.windows.net" -AzureBlobStorage3_connectionString "DefaultEndpointsProtocol=https;AccountName=stpayroll360qa001;AccountKey=9WLBIUk6ndW+WmyvqP7fy4FYMZDgy0z0dIjvGRP+sdzb4YifR42qwV5Erh0VoxNLfgD+s6Qa/Bt7Fz6LeMAgtQ==;EndpointSuffix=core.windows.net" -AzureBlobStorage4_connectionString "DefaultEndpointsProtocol=https;AccountName=stpayroll360qa001;AccountKey=9WLBIUk6ndW+WmyvqP7fy4FYMZDgy0z0dIjvGRP+sdzb4YifR42qwV5Erh0VoxNLfgD+s6Qa/Bt7Fz6LeMAgtQ==;EndpointSuffix=core.windows.net" -AzureBlobStorageRelius_connectionString "DefaultEndpointsProtocol=https;AccountName=stpayroll360qa001;AccountKey=9WLBIUk6ndW+WmyvqP7fy4FYMZDgy0z0dIjvGRP+sdzb4YifR42qwV5Erh0VoxNLfgD+s6Qa/Bt7Fz6LeMAgtQ==;EndpointSuffix=core.windows.net" -AzureIngestiontablelink_connectionString "Server=tcp:pcs-sql-payroll360-$(env).database.windows.net,1433;Initial Catalog=ingestion-$(env);Persist Security Info=False;User ID=serveradmin;Password=Welcome@123;MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;" -AzureSqlDBReliusValidn_connectionString "Server=tcp:pcs-sql-payroll360-$(env).database.windows.net,1433;Initial Catalog=ingestion-$(env);Persist Security Info=False;User ID=serveradmin;Password=Welcome@123;MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;" -AzureSqlDatabase1_connectionString "Server=tcp:pcs-sql-payroll360-$(env).database.windows.net,1433;Initial Catalog=config-$(env);Persist Security Info=False;User ID=serveradmin;Password=Welcome@123;MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;" -AzureSqlDatabaseVoya_connectionString "Server=tcp:pcs-sql-payroll360-$(env).database.windows.net,1433;Initial Catalog=config-$(env);Persist Security Info=False;User ID=serveradmin;Password=Welcome@123;MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;"  -AzureSqlDatabase1_connectionString "Server=tcp:pcs-sql-payroll360-$(env).database.windows.net,1433;Initial Catalog=ingestion-$(env);Persist Security Info=False;User ID=serveradmin;Password=Welcome@123;MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;" -AzureSqlDatabase1_connectionString "Server=tcp:pcs-sql-payroll360-$(env).database.windows.net,1433;Initial Catalog=config-$(env);Persist Security Info=False;User ID=serveradmin;Password=Welcome@123;MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;" -AzureSqlDatabaseVoya_connectionString "Server=tcp:pcs-sql-payroll360-$(env).database.windows.net,1433;Initial Catalog=config-$(env);Persist Security Info=False;User ID=serveradmin;Password=Welcome@123;MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;"  -AzureSqlDatabaseVoya_connectionString "Server=tcp:pcs-sql-payroll360-$(env).database.windows.net,1433;Initial Catalog=config-$(env);Persist Security Info=False;User ID=serveradmin;Password=Welcome@123;MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;" -AzureSqlDatabaseforVoya_connectionString "Server=tcp:pcs-sql-payroll360-$(env).database.windows.net,1433;Initial Catalog=config-$(env);Persist Security Info=False;User ID=serveradmin;Password=Welcome@123;MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;" -FtpServer1_password $(azurevmftppassword) -FtpServer2_password $(azurevmftppassword) -TransformVoyaLinkedService_accountKey "Server=tcp:pcs-sql-payroll360-$(env).database.windows.net,1433;Initial Catalog=config-$(env);Persist Security Info=False;User ID=serveradmin;Password=Welcome@123;MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;" -VoyaTransformLinkedService_connectionString "Server=tcp:pcs-sql-payroll360-$(env).database.windows.net,1433;Initial Catalog=config-$(env);Persist Security Info=False;User ID=serveradmin;Password=Welcome@123;MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;" -azureftpblob_connectionString "DefaultEndpointsProtocol=https;AccountName=stpayroll360qa001;AccountKey=9WLBIUk6ndW+WmyvqP7fy4FYMZDgy0z0dIjvGRP+sdzb4YifR42qwV5Erh0VoxNLfgD+s6Qa/Bt7Fz6LeMAgtQ==;EndpointSuffix=core.windows.net" -AzureBlobStorageSourceDatasetEntity_properties_typeProperties_fileName "@dataset().file_name" -AzureBlobStorageSourceDatasetEntity_properties_typeProperties_folderPath "@dataset().container_name" -FtpServer1_properties_typeProperties_host "52.249.195.251" -FtpServer1_properties_typeProperties_userName "ftpuser1" -FtpServer2_properties_typeProperties_host "52.249.195.251" -FtpServer2_properties_typeProperties_userName "ftpuser1" -TransformVoyaLinkedService_properties_typeProperties_url "https://$(storageqaname).dfs.core.windows.net" -ConsolidatedADFTrigger_properties_ConsolidatedPipeline_parameters_FileName "@triggerBody().fileName" -ConsolidatedADFTrigger_properties_ConsolidatedPipeline_parameters_FilePath "@triggerBody().folderPath" -ConsolidatedADFTrigger_properties_typeProperties_scope "/subscriptions/8aa224f7-539d-46b5-a81f-385ad15a78ab/resourceGroups/$(QA-rg-name)/providers/Microsoft.Storage/storageAccounts/$(storageqaname)" -TriggerForADFInsertFileReceivedOmni_properties_typeProperties_scope "/subscriptions/8aa224f7-539d-46b5-a81f-385ad15a78ab/resourceGroups/$(QA-rg-name)/providers/Microsoft.Storage/storageAccounts/$(storageqaname)" -TriggerForADFInsertFileReceivedPaylocity_properties_typeProperties_scope "/subscriptions/8aa224f7-539d-46b5-a81f-385ad15a78ab/resourceGroups/$(QA-rg-name)/providers/Microsoft.Storage/storageAccounts/$(storageqaname)" -TriggerForADFInsertFileReceivedReliusPaylocity_properties_PipelineReliusPaylocity_parameters_FileName "@triggerBody().fileName" -TriggerForADFInsertFileReceivedReliusPaylocity_properties_PipelineReliusPaylocity_parameters_FilePath "@triggerBody().folderPath" -TriggerForADFInsertFileReceivedReliusPaylocity_properties_typeProperties_scope "/subscriptions/8aa224f7-539d-46b5-a81f-385ad15a78ab/resourceGroups/$(QA-rg-name)/providers/Microsoft.Storage/storageAccounts/$(storageqaname)" -TriggerForADFInsertFileReceivedSchoolsfirst_properties_typeProperties_scope "/subscriptions/8aa224f7-539d-46b5-a81f-385ad15a78ab/resourceGroups/$(QA-rg-name)/providers/Microsoft.Storage/storageAccounts/$(storageqaname)" -TriggerForADFInsertFileReceivedVoya_properties_typeProperties_scope "/subscriptions/8aa224f7-539d-46b5-a81f-385ad15a78ab/resourceGroups/$(QA-rg-name)/providers/Microsoft.Storage/storageAccounts/$(storageqaname)"
      deploymentMode: Validation
  - task: PublishBuildArtifacts@1
    displayName: 'Publish Artifact: drop'
    inputs:
      PathtoPublish: pcs-adf-payroll360-dev
...
